"use client";
import { useState } from "react";

export default function Alici() {
  const [ok, setOk] = useState(false);
  const [sending, setSending] = useState(false);
  const [err, setErr] = useState<string | null>(null);

  async function submit(e: React.FormEvent<HTMLFormElement>) {
    e.preventDefault();
    setSending(true); setErr(null);

    const fd = new FormData(e.currentTarget);
    // e-posta opsiyonel; telefon zorunlu
    const res = await fetch("/api/lead", { method: "POST", body: fd });
    setSending(false);

    if (res.ok) setOk(true);
    else setErr("Gönderim sırasında bir sorun oluştu. Lütfen tekrar deneyin.");
  }

  if (ok) {
    return (
      <main className="max-w-md mx-auto p-5">
        <h1 className="text-xl font-semibold">Talebiniz alındı ✅</h1>
        <p className="mt-2 text-sm text-zinc-700">
          Danışmanlarımız kriterlerinize uygun portföy için en kısa sürede sizinle iletişime geçecek.
        </p>
      </main>
    );
  }

  return (
    <main className="max-w-md mx-auto p-5 space-y-8">
      {/* Kısa bilgilendirme */}
      <section className="space-y-2">
        <h1 className="text-2xl font-semibold">Yatırımlık Ev Arıyorum</h1>
        <p className="text-sm text-zinc-700">
          Avukat + inşaat mühendisi ekip ile kriterlerinize uygun en iyi yatırımı buluyor, pazarlık–hukuki/teknik kontrol–tapu sürecini A’dan Z’ye yönetiyoruz.
        </p>
        {/* Mini SSS (özet) */}
        <div className="rounded-lg border divide-y">
          <details className="p-4">
            <summary className="font-medium cursor-pointer">Ücretlendirme</summary>
            <p className="mt-2 text-sm text-zinc-700">Satın alma gerçekleşirse %2 + KDV.</p>
          </details>
          <details className="p-4">
            <summary className="font-medium cursor-pointer">Çalışma şekli</summary>
            <p className="mt-2 text-sm text-zinc-700">Sözleşme esaslı; yalnızca tarafımızdan önerilen ev alınırsa ücret doğar.</p>
          </details>
          <details className="p-4">
            <summary className="font-medium cursor-pointer">Şehirler</summary>
            <p className="mt-2 text-sm text-zinc-700">İstanbul, Ankara, İzmir, Samsun, Trabzon, Sinop, Diyarbakır, Van, Erzurum, Denizli…</p>
          </details>
        </div>
      </section>

      {/* Form */}
      <form onSubmit={submit} className="space-y-4">
        <div className="grid grid-cols-2 gap-3">
          <input name="firstName" required placeholder="Ad" className="border rounded-lg p-3" />
          <input name="lastName" required placeholder="Soyad" className="border rounded-lg p-3" />
        </div>

        <input name="phone" required placeholder="Telefon (WhatsApp)" className="w-full border rounded-lg p-3" />
        <input type="email" name="email" placeholder="E-posta (opsiyonel)" className="w-full border rounded-lg p-3" />

        <select name="city" required className="w-full border rounded-lg p-3">
          <option value="">Şehir seçin</option>
          <option>İstanbul (Avrupa)</option><option>İstanbul (Anadolu)</option><option>Ankara</option><option>İzmir</option>
          <option>Antalya</option><option>Bursa</option><option>Konya</option><option>Muğla</option>
          <option>Mersin</option><option>Adana</option><option>Samsun</option><option>Trabzon</option>
          <option>Gaziantep</option><option>Diyarbakır</option><option>Erzurum</option><option>Van</option>
        </select>

        <textarea name="criteria" required placeholder="Aradığınız evin kriterleri (bütçe, oda, bölge, kira/değer artışı…)"
          className="w-full border rounded-lg p-3 h-28" />

        <label className="text-sm text-zinc-700 inline-flex items-start gap-2">
          <input type="checkbox" name="contractOk" required />
          <span>
            Sözleşme esaslı çalıştığınızı, yalnızca tarafınızdan önerilen/gösterilen evi almam halinde
            <b> %2 + KDV</b> hizmet bedeli ödeyeceğimi kabul ediyorum.
          </span>
        </label>

        {/* gizli alanlar (kaynak takibi vs.) */}
        <input type="hidden" name="formType" value="alici" />
        <input type="hidden" name="source" value="website" />

        <button disabled={sending} className="w-full rounded-lg border p-3 font-medium">
          {sending ? "Gönderiliyor..." : "Gönder"}
        </button>

        {err && <p className="text-red-600 text-sm">{err}</p>}
      </form>
    </main>
  );
}
